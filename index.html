<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Grading System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>

<body>
  <div id="root"></div>

  <!-- storage compatibility layer -->
  <script>
    window.storage = {
      async get(key) {
        const value = localStorage.getItem(key);
        return value !== null ? { value } : null;
      },
      async set(key, value) {
        localStorage.setItem(key, value);
      }
    };
  </script>

  <script type="text/babel">

const {
  Eye, EyeOff, Plus, Save, Trash2, Calendar, Edit2, Check, X
} = lucide;

const { useState, useEffect } = React;

const MASTER_PASSWORD = 'instructor2026';

function GradingApp() {
  const [view, setView] = useState('login');
  const [password, setPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [currentUser, setCurrentUser] = useState(null);
  const [error, setError] = useState('');

  const [classes, setClasses] = useState({ 'Class I': [], 'Class II': [], 'Class III': [] });
  const [sessions, setSessions] = useState([]);
  const [selectedClass, setSelectedClass] = useState('Class I');
  const [selectedDate, setSelectedDate] = useState('');
  const [currentSession, setCurrentSession] = useState(null);
  const [loading, setLoading] = useState(true);

  const [newStudentName, setNewStudentName] = useState('');
  const [newStudentPassword, setNewStudentPassword] = useState('');
  const [addingToClass, setAddingToClass] = useState('');

  const [editingStudent, setEditingStudent] = useState(null);
  const [editName, setEditName] = useState('');
  const [editPassword, setEditPassword] = useState('');

  useEffect(() => { loadData(); }, []);

  async function loadData() {
    try {
      const c = await window.storage.get('classes');
      const s = await window.storage.get('sessions');
      if (c?.value) setClasses(JSON.parse(c.value));
      if (s?.value) setSessions(JSON.parse(s.value));
    } finally {
      setLoading(false);
    }
  }

  async function addStudent(className) {
    if (!newStudentName || !newStudentPassword) return alert('Enter name and password');

    for (const cls in classes) {
      if (classes[cls].some(s => s.password === newStudentPassword)) {
        return alert('Password already in use');
      }
    }

    const updated = {
      ...classes,
      [className]: [...classes[className], { name: newStudentName, password: newStudentPassword }]
    };

    setClasses(updated);
    setNewStudentName('');
    setNewStudentPassword('');
    setAddingToClass('');
    await window.storage.set('classes', JSON.stringify(updated));
  }

  async function removeStudent(className, index) {
    if (!confirm('Remove student?')) return;

    const updated = {
      ...classes,
      [className]: classes[className].filter((_, i) => i !== index)
    };

    setClasses(updated);
    await window.storage.set('classes', JSON.stringify(updated));
  }

  if (loading) {
    return <div className="p-10 text-xl">Loading…</div>;
  }

  return (
    <div className="min-h-screen bg-gray-50 p-4">
      <h1 className="text-2xl font-bold mb-4">Student Grading System</h1>

      {Object.keys(classes).map(cls => (
        <div key={cls} className="bg-white p-4 rounded shadow mb-4">
          <h2 className="font-semibold mb-2">{cls}</h2>

          {classes[cls].map((s, i) => (
            <div key={s.password} className="flex justify-between bg-gray-100 p-2 mb-1 rounded">
              <span>{s.name}</span>
              <button onClick={() => removeStudent(cls, i)} className="text-red-600">
                <Trash2 size={16} />
              </button>
            </div>
          ))}

          {addingToClass === cls ? (
            <div className="mt-2 space-y-2">
              <input
                placeholder="Name"
                value={newStudentName}
                onChange={e => setNewStudentName(e.target.value)}
                className="border p-1 w-full"
              />
              <input
                placeholder="Password"
                value={newStudentPassword}
                onChange={e => setNewStudentPassword(e.target.value)}
                className="border p-1 w-full"
              />
              <button onClick={() => addStudent(cls)} className="bg-green-600 text-white px-2 py-1 rounded">
                Add
              </button>
            </div>
          ) : (
            <button onClick={() => setAddingToClass(cls)} className="mt-2 text-blue-600">
              + Add Student
            </button>
          )}
        </div>
      ))}
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<GradingApp />);

  </script>
</body>
</html>